<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shiptrack - Seguimiento de Carga</title>
    <!-- CSS externo sugerido para caché -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/1063/1063191.png" />
    <style>
        :root { --primary: #003366; --dark: #002244; --light-bg: #f4f4f4; }
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: var(--light-bg); }
        header { background: var(--primary); color: #fff; padding: 15px; text-align: center; }
        nav { background: var(--dark); padding: 10px; display: flex; justify-content: center; gap: 20px; }
        nav a { color: #fff; text-decoration: none; font-weight: bold; }
        nav a:hover { text-decoration: underline; }
        .contenedor { max-width: 1000px; margin: 20px auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); text-align: center; }
        input, button, textarea { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; }
        button { background: var(--primary); color: #fff; border: none; cursor: pointer; }
        button:hover { background: var(--dark); }
        #mapa { margin: 20px auto; width: 90%; height: 500px; }
        table { width: 90%; margin: 20px auto; border-collapse: collapse; background: #fff; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background: var(--primary); color: #fff; }
        .seccion-oculta { display: none; }
        .formulario-contacto { background: #fff; padding: 20px; margin: 30px auto; border-radius: 8px; max-width: 600px; }
        .boton-flotante { position: fixed; bottom: 20px; right: 20px; background: var(--primary); color: #fff; border: none; border-radius: 50%; width: 60px; height: 60px; font-size: 24px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.3); z-index: 1000; transition: 0.2s ease; }
        .boton-flotante:hover { background: #005599; transform: scale(1.1); }
        .panel-estadisticas { position: fixed; bottom: 90px; right: 20px; width: 320px; background: #fff; border-radius: 10px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: none; opacity: 0; transform: translateY(10px); transition: 0.3s ease; z-index: 999; }
        .panel-estadisticas.activo { display: block; opacity: 1; transform: translateY(0); }
        .cerrar-panel { background: none; border: none; font-size: 20px; position: absolute; top: 8px; right: 10px; cursor: pointer; color: #888; }
        .cerrar-panel:hover { color: #333; }
        .chatbot-button { position: fixed; bottom: 70px; right: 85px; background: #0077cc; color: #fff; border: none; border-radius: 50%; width: 60px; height: 60px; font-size: 24px; box-shadow: 0 0 10px rgba(0,0,0,0.3); cursor: pointer; z-index: 998; }
    </style>
</head>
<body>
    <header>
        <h1>Shiptrack - Seguimiento de Carga</h1>
        <p>Seguimiento de carga marítima en tiempo real</p>
    </header>
    <nav>
        <a href="#inicio">Inicio</a>
        <a href="#busqueda">BL</a>
        <a href="#simulador">Simulador</a>
        <a href="#mapa">Mapa</a>
        <a href="#usuario">Usuario</a>
        <a href="#contacto">Contacto</a>
        <a href="#ayuda">Ayuda</a>
        <a href="#cuenta">Mi Cuenta</a>
    </nav>

    <div id="inicio" class="contenedor">
        <input type="text" id="blInput" placeholder="Número de BL (mínimo 6 caracteres)" required>
        <button onclick="buscarBLPrincipal()">Buscar</button>
    </div>
    <div id="busqueda" class="contenedor seccion-oculta">
        <h2>Buscar conocimiento de embarque (BL)</h2>
        <form onsubmit="buscarBLSecundario(); return false;">
            <input type="text" id="blNumber" placeholder="Ingresa el número BL" required>
            <button type="submit"><i class="fas fa-search"></i> Buscar</button>
        </form>
        <div id="resultContainer">Introduce un número BL para ver resultados aquí.</div>
    </div>

    <div id="mapa"></div>
    <table>
        <thead>
            <tr><th>Puerto</th><th>Evento / Tránsito</th><th>Fecha</th></tr>
        </thead>
        <tbody id="tablaEventos"></tbody>
    </table>

    <div id="cuenta" class="contenedor seccion-oculta">
        <h2>Mi Cuenta</h2>
        <p>Próximamente: guarda tus BL y personaliza notificaciones.</p>
    </div>
    <div id="simulador" class="contenedor seccion-oculta">
        <h2>Simulador de carga</h2>
        <form onsubmit="simularCarga(); return false;">
            <input type="text" id="origen" placeholder="Puerto origen" required>
            <input type="text" id="destino" placeholder="Puerto destino" required>
            <input type="number" id="peso" placeholder="Peso (kg)" required>
            <button type="submit">Simular</button>
        </form>
        <div id="simuladorResultado"></div>
    </div>
    <div id="usuario" class="contenedor seccion-oculta">
        <h2>Área de Usuario</h2>
        <form onsubmit="iniciarSesion(); return false;">
            <input type="text" id="usuarioNombre" placeholder="Usuario" required>
            <input type="password" id="usuarioClave" placeholder="Contraseña" required>
            <button type="submit">Iniciar sesión</button>
        </form>
        <div id="usuarioMensaje"></div>
    </div>
    <div id="contacto" class="formulario-contacto">
        <h2>Contacto</h2>
        <form onsubmit="enviarFormularioPrincipal(event)">
            <input type="text" id="nombre" placeholder="Tu nombre" required>
            <input type="email" id="email" placeholder="Tu correo electrónico" required>
            <textarea id="mensaje" placeholder="Tu mensaje" rows="5" required></textarea>
            <button type="submit">Enviar</button>
        </form>
        <p>O escríbenos a <a href="mailto:soporte@shiptrack.com">soporte@shiptrack.com</a> o <a href="https://wa.me/1234567890" target="_blank">WhatsApp</a>.</p>
    </div>
    <div id="ayuda" class="contenedor seccion-oculta">
        <h2>Ayuda</h2>
        <p>Preguntas frecuentes y guía de uso de Shiptrack.</p>
    </div>

    <button class="boton-flotante" onclick="togglePanel()"><i class="fas fa-chart-bar"></i></button>
    <div id="panelEstadisticas" class="panel-estadisticas">
        <button class="cerrar-panel" onclick="togglePanel()">&times;</button>
        <h3><i class="fas fa-chart-bar"></i> Estadísticas</h3>
        <div class="stat-item">Cargas: <span id="totalCargasPanel">0</span></div>
        <div class="stat-item">Rutas comunes:<ul id="rutasComunesPanel"></ul></div>
        <div class="stat-item">Tiempo tránsito: <span id="promedioTransitoPanel">-</span></div>
    </div>
    <button class="chatbot-button" onclick="alert('¿En qué puedo ayudarte?')"><i class="fas fa-robot"></i></button>

    <footer>&copy; 2025 Shiptrack. Desarrollo por Juan Giraldo & Dylan Díaz.</footer>

    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" defer></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const map = L.map('mapa').setView([20,0],2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }).addTo(map);
        let polyline, markers = [], cargas = 0;
        const tablaEventos = document.getElementById('tablaEventos');
        const totalCargasPanel = document.getElementById('totalCargasPanel');
        const rutasComunesPanel = document.getElementById('rutasComunesPanel');
        const promedioTransitoPanel = document.getElementById('promedioTransitoPanel');

        function buscarBLPrincipal() {
            const bl = document.getElementById('blInput').value.trim();
            if (bl.length < 6) return alert('BL inválido');
            let hist = JSON.parse(localStorage.getItem('busquedas'))||[];
            hist.push({bl, fecha:new Date().toISOString()});
            localStorage.setItem('busquedas', JSON.stringify(hist));
            tablaEventos.innerHTML = '';
            markers.forEach(m=>map.removeLayer(m)); markers=[];
            if(polyline)map.removeLayer(polyline);
            let ruta=[];
            if(bl==='MEDUQT871264') ruta=[{nombre:'Qingdao',coords:[36.0671,120.3826],tiempo:'17 Feb 2025'},{nombre:'Busan',coords:[35.1796,129.0756],tiempo:'22-23 Feb 2025'},{nombre:'Buenaventura',coords:[3.8801,-77.0312],tiempo:'25 Mar 2025'}];
            else if(bl==='250339340') ruta=[{nombre:'Shanghai',coords:[31.2304,121.4737],tiempo:'24 Feb 2025'},{nombre:'Carga',coords:[31.2304,121.4737],tiempo:'26 Feb-5 Mar'},{nombre:'Salida',coords:[31.2304,121.4737],tiempo:'6 Mar'},{nombre:'Llegada',coords:[3.8801,-77.0312],tiempo:'3 Abr'},{nombre:'Alta',coords:[3.8801,-77.0312],tiempo:'4 Abr'},{nombre:'Regreso',coords:[3.8801,-77.0312],tiempo:'8-9 Abr'}];
            else return alert('BL no reconocido');
            const coords=[];
            ruta.forEach(p=>{
                markers.push(L.marker(p.coords).addTo(map).bindPopup(`${p.nombre} - ${p.tiempo}`));
                coords.push(p.coords);
                let r=tablaEventos.insertRow(); r.insertCell(0).innerText=p.nombre; r.insertCell(1).innerText=p.tiempo; r.insertCell(2).innerText='-';
            });
            if(coords.length>1){ polyline=L.polyline(coords,{color:'blue'}).addTo(map); map.fitBounds(polyline.getBounds()); }
            cargas++; actualizarEstadisticas();
        }
        function buscarBLSecundario() {
            const bl=document.getElementById('blNumber').value;
            const cont=document.getElementById('resultContainer'); cont.innerText=`Buscando BL ${bl}...`;
            setTimeout(()=>cont.innerHTML+='\nResultado simulado: tránsito, ETA 7 días.',1000);
        }
        function simularCarga() {
            const o=document.getElementById('origen').value;
            const d=document.getElementById('destino').value;
            const p=parseFloat(document.getElementById('peso').value);
            const res=document.getElementById('simuladorResultado');
            const tarifas={'shanghai-buenaventura':0.45,'qingdao-busan-buenaventura':0.50,'busan-buenaventura':0.42,'shanghai-singapur':0.30};
            const key=`${o.toLowerCase()}-${d.toLowerCase()}`;
            if(!o||!d||isNaN(p)||p<=0){ res.innerText='Datos inválidos'; return; }
            const t=tarifas[key];
            if(!t){ res.innerHTML=`Ruta ${o}→${d} no registrada.`; return; }
            const dias=12+Math.floor(Math.random()*5);
            res.innerHTML=`<b>Costo:</b> $${(p*t).toFixed(2)} USD<br><b>Días:</b> ${dias}`;
        }
        function iniciarSesion() {
            const u=document.getElementById('usuarioNombre').value;
            const c=document.getElementById('usuarioClave').value;
            document.getElementById('usuarioMensaje').innerText=(u==='admin'&&c==='1234')?'Sesión exitosa':'Credenciales inválidas';
        }
        function enviarFormularioPrincipal(e) {
            e.preventDefault(); alert(`Gracias, ${document.getElementById('nombre').value}`);
            e.target.reset();
        }
        function actualizarEstadisticas() {
            totalCargasPanel.innerText=cargas;
            rutasComunesPanel.innerHTML=''; ['Shanghai-Buenaventura','Qingdao-Busan-Buenaventura'].forEach(r=>{
                const li=document.createElement('li'); li.innerText=r; rutasComunesPanel.appendChild(li);
            });
            promedioTransitoPanel.innerText='25-35 días';
        }
        function togglePanel() {
            document.getElementById('panelEstadisticas').classList.toggle('activo');
        }
        document.addEventListener('click', e=>{
            const panel=document.getElementById('panelEstadisticas');
            if(panel.classList.contains('activo')&&!panel.contains(e.target)&&!document.querySelector('.boton-flotante').contains(e.target)){
                panel.classList.remove('activo');
            }
        });
        document.querySelector('nav').addEventListener('click', e=>{
            if(e.target.tagName==='A'){
                e.preventDefault();
                document.querySelectorAll('.contenedor').forEach(s=>s.classList.add('seccion-oculta'));
                document.getElementById(e.target.getAttribute('href').substring(1)).classList.remove('seccion-oculta');
            }
        });
    });
    </script>
</body>
</html>
