<!DOCTYPE html>
<html lang="es" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Shiptrack - Seguimiento de Carga</title>
  <link rel="icon" href="assets/logo-dark.png" type="image/png"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200">

  <!-- HEADER -->
  <header class="bg-blue-800 dark:bg-gray-800 text-white p-4 flex justify-between items-center">
    <div class="flex items-center space-x-3">
      <img src="assets/logo-dark.png" class="h-10 w-10" alt="Logo"/>
      <h1 class="text-xl font-semibold">Shiptrack</h1>
    </div>
    <button id="themeToggle" class="p-2 rounded hover:bg-blue-700 dark:hover:bg-gray-700">
      <i class="fas fa-moon" id="themeIcon"></i>
    </button>
  </header>

  <!-- NAV -->
  <nav class="bg-blue-600 dark:bg-gray-700 text-white">
    <div class="max-w-6xl mx-auto px-4">
      <div class="flex justify-center space-x-4">
        <a href="#inicio" class="py-3 px-2 hover:bg-blue-500 rounded">Inicio</a>
        <a href="#simulador" class="py-3 px-2 hover:bg-blue-500 rounded">Simulador</a>
        <a href="#contacto" class="py-3 px-2 hover:bg-blue-500 rounded">Contacto</a>
      </div>
    </div>
  </nav>

  <main class="max-w-4xl mx-auto p-4 space-y-6">

    <!-- Buscar BL -->
    <section id="inicio" class="bg-white dark:bg-gray-800 p-6 rounded shadow relative">
      <h2 class="text-2xl mb-4 font-bold">Buscar BL</h2>
      <form class="flex gap-4" onsubmit="return buscarBL();">
        <div class="flex-1 relative">
          <input id="blNumber" type="text" placeholder=" " required minlength="6"
                 class="peer w-full border-b-2 border-gray-300 bg-transparent py-2 px-0 focus:outline-none"/>
          <label for="blNumber"
                 class="absolute left-0 -top-3.5 text-gray-500 text-sm transition-all peer-placeholder-shown:top-2 peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-400 peer-focus:-top-3.5 peer-focus:text-gray-300">
            Número de BL
          </label>
        </div>
        <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded">
          <i class="fas fa-search"></i>
        </button>
      </form>
      <!-- Historial -->
      <button onclick="toggleHist()" class="absolute top-6 right-6 p-2 bg-gray-200 rounded-full hover:bg-gray-300">
        <i class="fas fa-history"></i>
      </button>
      <div id="histPanel" class="absolute top-16 right-6 w-48 max-h-48 overflow-auto bg-white dark:bg-gray-800 border hidden">
        <ul id="histList"></ul>
      </div>
    </section>

    <!-- Mapa y Tabla -->
    <div id="mapa" class="h-64 rounded shadow"></div>
    <section class="bg-white dark:bg-gray-800 p-4 rounded shadow">
      <h3 class="text-xl mb-2 font-bold">Eventos</h3>
      <table class="w-full text-left">
        <thead>
          <tr>
            <th class="border-b p-1">Evento</th>
            <th class="border-b p-1">Fecha</th>
          </tr>
        </thead>
        <tbody id="tablaEventos"></tbody>
      </table>
    </section>

    <!-- Simulador -->
    <section id="simulador" class="bg-white dark:bg-gray-800 p-6 rounded shadow hidden">
      <h2 class="text-2xl font-bold mb-4">Simulador</h2>
      <!-- ... tu formulario de simulador ... -->
    </section>

    <!-- Contacto -->
    <section id="contacto" class="bg-white dark:bg-gray-800 p-6 rounded shadow hidden">
      <h2 class="text-2xl font-bold mb-4">Contacto</h2>
      <!-- ... tu formulario de contacto ... -->
    </section>

  </main>

  <footer class="bg-blue-800 dark:bg-gray-800 text-white text-center p-4">
    © 2025 Shiptrack
  </footer>

  <script>
    // Theme toggle
    const btnTheme = document.getElementById('themeToggle'),
          icoTheme = document.getElementById('themeIcon');
    btnTheme.onclick = () => {
      document.documentElement.classList.toggle('dark');
      icoTheme.classList.toggle('fa-sun');
      icoTheme.classList.toggle('fa-moon');
    };

    // Sections nav
    document.querySelectorAll('nav a').forEach(a => {
      a.onclick = e => {
        e.preventDefault();
        document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
        document.getElementById(a.getAttribute('href').substring(1)).classList.remove('hidden');
      }
    });

    // Leaflet init
    const map = L.map('mapa').setView([20,0],2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    let markers = [], poly;

    function resetRoute() {
      markers.forEach(m => map.removeLayer(m));
      markers = [];
      if(poly) map.removeLayer(poly);
      document.getElementById('tablaEventos').innerHTML = '';
    }

    // BL logic
    function buscarBL() {
      const bl = document.getElementById('blNumber').value.trim();
      if(bl.length < 6) return false;

      // Historial
      const h = JSON.parse(localStorage.getItem('hist') || '[]');
      h.push(bl);
      localStorage.setItem('hist', JSON.stringify(h));

      resetRoute();

      let ruta = [];
      if (bl === 'MEDUQT871264') {
        ruta = [
          { nombre: 'Qingdao - Cargado', coords: [36.0671,120.3826], tiempo: '17 feb 2025' },
          { nombre: 'Busan - Transbordo', coords: [35.1796,129.0756], tiempo: '22-23 feb 2025' },
          { nombre: 'Buenaventura - Descarga', coords: [3.8801,-77.0312], tiempo: '25 mar 2025' }
        ];
      } else if (bl === '250339340') {
        ruta = [
          { nombre: 'Shanghai - Vacío', coords: [31.2304,121.4737], tiempo: '24 feb 2025' },
          { nombre: 'Salida buque', coords: [31.2304,121.4737], tiempo: '6 mar 2025' },
          { nombre: 'Buenaventura - Llegada', coords: [3.8801,-77.0312], tiempo: '3 abr 2025' }
        ];
      } else {
        alert('BL no reconocido');
        return false;
      }

      // Dibujar
      const latlngs = [];
      ruta.forEach(pt => {
        const m = L.marker(pt.coords).addTo(map).bindPopup(`${pt.nombre}<br>${pt.tiempo}`);
        markers.push(m);
        latlngs.push(pt.coords);
        const tr = document.getElementById('tablaEventos').insertRow();
        tr.insertCell().textContent = pt.nombre;
        tr.insertCell().textContent = pt.tiempo;
      });
      if(latlngs.length>1) {
        poly = L.polyline(latlngs, { color: 'blue' }).addTo(map);
        map.fitBounds(poly.getBounds());
      }
      return false;
    }

    // Historial panel
    function toggleHist() {
      const panel = document.getElementById('histPanel'),
            ul    = document.getElementById('histList');
      panel.classList.toggle('hidden');
      if(!panel.classList.contains('hidden')) {
        ul.innerHTML = '';
        const h = JSON.parse(localStorage.getItem('hist')||'[]').reverse();
        [...new Set(h)].forEach(b => {
          const li = document.createElement('li');
          li.textContent = b;
          li.className = 'p-2 hover:bg-gray-200 cursor-pointer';
          li.onclick = () => { document.getElementById('blNumber').value = b; toggleHist(); buscarBL(); };
          ul.appendChild(li);
        });
      }
    }
  </script>
</body>
</html>

